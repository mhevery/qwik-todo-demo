/**
 * @license
 * Copyright BuilderIO All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/BuilderIO/qwik/blob/main/LICENSE
 */
import { markDirty, QRL, Entity, getInjector, entityStateKey, toEntityKey, } from '../qwik.js';
import { ItemEntity } from './Item.js';
export class TodoEntity extends Entity {
    constructor() {
        super(...arguments);
        this.filteredItems = [];
    }
    async archive() {
        return this.$invokeQRL(QRL `data:/Todo_archive`);
    }
    async newItem(text) {
        return this.$invokeQRL(QRL `data:/Todo_newItem`, text);
    }
    remove(itemKey) {
        return this.$invokeQRL(QRL `data:/Todo_removeItem`, itemKey);
    }
    async setFilter(filter) {
        const injector = getInjector(this.$element);
        const itemStatePromises = this.$state.items.map((itemKey) => injector.getEntityState(itemKey));
        const items = await Promise.all(itemStatePromises);
        this.filteredItems = items
            .filter({
            all: () => true,
            active: (item) => !item.completed,
            completed: (item) => item.completed,
        }[filter])
            .map(entityStateKey); // TODO(type): fix cast
        this.$state.filter = filter;
        markDirty(this);
    }
    async $init() {
        this.filteredItems = this.$state.items;
    }
    async $newState() {
        const host = this.$element;
        return {
            completed: 0,
            filter: 'all',
            nextId: 4,
            items: [
                ItemEntity.$hydrate(host, { id: '1' }, { completed: false, title: 'Read Qwik docs' }).$key,
                ItemEntity.$hydrate(host, { id: '2' }, { completed: false, title: 'Build HelloWorld' })
                    .$key,
                ItemEntity.$hydrate(host, { id: '3' }, { completed: false, title: 'Profit' }).$key,
            ],
        };
    }
}
TodoEntity.$qrl = QRL `data:/Todo#TodoEntity`;
TodoEntity.$type = 'Todos';
TodoEntity.$keyProps = ['todos'];
TodoEntity.MOCK_USER = toEntityKey('todos:1234');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9kby5qcyIsInNvdXJjZVJvb3QiOiIuLyIsInNvdXJjZXMiOlsic3JjL2RhdGEvVG9kby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFFSCxPQUFPLEVBQ0wsU0FBUyxFQUNULEdBQUcsRUFDSCxNQUFNLEVBQ04sV0FBVyxFQUVYLGNBQWMsRUFDZCxXQUFXLEdBQ1osTUFBTSxZQUFZLENBQUM7QUFDcEIsT0FBTyxFQUFRLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQVc3QyxNQUFNLE9BQU8sVUFBVyxTQUFRLE1BQXVCO0lBQXZEOztRQU1FLGtCQUFhLEdBQTRCLEVBQUUsQ0FBQztJQXNEOUMsQ0FBQztJQXBEQyxLQUFLLENBQUMsT0FBTztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQVksb0JBQW9CLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFZO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQXVDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9GLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBOEI7UUFDbkMsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUNwQixHQUFHLENBQStDLHVCQUF1QixFQUN6RSxPQUFPLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQXNDO1FBQ3BELE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUMsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUMxRCxRQUFRLENBQUMsY0FBYyxDQUFhLE9BQU8sQ0FBQyxDQUM3QyxDQUFDO1FBQ0YsTUFBTSxLQUFLLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLO2FBQ3ZCLE1BQU0sQ0FDTDtZQUNFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJO1lBQ2YsTUFBTSxFQUFFLENBQUMsSUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO1lBQ3ZDLFNBQVMsRUFBRSxDQUFDLElBQVUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVM7U0FDMUMsQ0FBQyxNQUFNLENBQUMsQ0FDVjthQUNBLEdBQUcsQ0FBQyxjQUE2QyxDQUFDLENBQUMsQ0FBQyx1QkFBdUI7UUFDOUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQzVCLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQUs7UUFDVCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxLQUFLLENBQUMsU0FBUztRQUNiLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDM0IsT0FBTztZQUNMLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEtBQUs7WUFDYixNQUFNLEVBQUUsQ0FBQztZQUNULEtBQUssRUFBRTtnQkFDTCxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxJQUFJO2dCQUMxRixVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLENBQUM7cUJBQ3BGLElBQUk7Z0JBQ1AsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUk7YUFDbkY7U0FDRixDQUFDO0lBQ0osQ0FBQzs7QUExRE0sZUFBSSxHQUFHLEdBQUcsQ0FBWSx1QkFBdUIsQ0FBQztBQUM5QyxnQkFBSyxHQUFHLE9BQU8sQ0FBQztBQUNoQixvQkFBUyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDdEIsb0JBQVMsR0FBRyxXQUFXLENBQWEsWUFBWSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQnVpbGRlcklPIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9naXRodWIuY29tL0J1aWxkZXJJTy9xd2lrL2Jsb2IvbWFpbi9MSUNFTlNFXG4gKi9cblxuaW1wb3J0IHtcbiAgbWFya0RpcnR5LFxuICBRUkwsXG4gIEVudGl0eSxcbiAgZ2V0SW5qZWN0b3IsXG4gIEVudGl0eUtleSxcbiAgZW50aXR5U3RhdGVLZXksXG4gIHRvRW50aXR5S2V5LFxufSBmcm9tICcuLi9xd2lrLmpzJztcbmltcG9ydCB7IEl0ZW0sIEl0ZW1FbnRpdHkgfSBmcm9tICcuL0l0ZW0uanMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRvZG9Qcm9wcyB7fVxuXG5leHBvcnQgaW50ZXJmYWNlIFRvZG8ge1xuICBjb21wbGV0ZWQ6IG51bWJlcjtcbiAgZmlsdGVyOiAnYWN0aXZlJyB8ICdhbGwnIHwgJ2NvbXBsZXRlZCc7XG4gIGl0ZW1zOiBFbnRpdHlLZXk8SXRlbUVudGl0eT5bXTtcbiAgbmV4dElkOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBUb2RvRW50aXR5IGV4dGVuZHMgRW50aXR5PFRvZG9Qcm9wcywgVG9kbz4ge1xuICBzdGF0aWMgJHFybCA9IFFSTDxJdGVtRW50aXR5PmBkYXRhOi9Ub2RvI1RvZG9FbnRpdHlgO1xuICBzdGF0aWMgJHR5cGUgPSAnVG9kb3MnO1xuICBzdGF0aWMgJGtleVByb3BzID0gWyd0b2RvcyddO1xuICBzdGF0aWMgTU9DS19VU0VSID0gdG9FbnRpdHlLZXk8VG9kb0VudGl0eT4oJ3RvZG9zOjEyMzQnKTtcblxuICBmaWx0ZXJlZEl0ZW1zOiBFbnRpdHlLZXk8SXRlbUVudGl0eT5bXSA9IFtdO1xuXG4gIGFzeW5jIGFyY2hpdmUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuJGludm9rZVFSTChRUkw8KCkgPT4gdm9pZD5gZGF0YTovVG9kb19hcmNoaXZlYCk7XG4gIH1cblxuICBhc3luYyBuZXdJdGVtKHRleHQ6IHN0cmluZyk6IFByb21pc2U8SXRlbUVudGl0eT4ge1xuICAgIHJldHVybiB0aGlzLiRpbnZva2VRUkwoUVJMPCh0ZXh0OiBzdHJpbmcpID0+IFByb21pc2U8SXRlbUVudGl0eT4+YGRhdGE6L1RvZG9fbmV3SXRlbWAsIHRleHQpO1xuICB9XG5cbiAgcmVtb3ZlKGl0ZW1LZXk6IEVudGl0eUtleTxJdGVtRW50aXR5Pikge1xuICAgIHJldHVybiB0aGlzLiRpbnZva2VRUkwoXG4gICAgICBRUkw8KGtleTogRW50aXR5S2V5PEl0ZW1FbnRpdHk+KSA9PiBQcm9taXNlPHZvaWQ+PmBkYXRhOi9Ub2RvX3JlbW92ZUl0ZW1gLFxuICAgICAgaXRlbUtleVxuICAgICk7XG4gIH1cblxuICBhc3luYyBzZXRGaWx0ZXIoZmlsdGVyOiAnYWN0aXZlJyB8ICdhbGwnIHwgJ2NvbXBsZXRlZCcpIHtcbiAgICBjb25zdCBpbmplY3RvciA9IGdldEluamVjdG9yKHRoaXMuJGVsZW1lbnQpO1xuICAgIGNvbnN0IGl0ZW1TdGF0ZVByb21pc2VzID0gdGhpcy4kc3RhdGUuaXRlbXMubWFwKChpdGVtS2V5KSA9PlxuICAgICAgaW5qZWN0b3IuZ2V0RW50aXR5U3RhdGU8SXRlbUVudGl0eT4oaXRlbUtleSlcbiAgICApO1xuICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgUHJvbWlzZS5hbGwoaXRlbVN0YXRlUHJvbWlzZXMpO1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IGl0ZW1zXG4gICAgICAuZmlsdGVyKFxuICAgICAgICB7XG4gICAgICAgICAgYWxsOiAoKSA9PiB0cnVlLFxuICAgICAgICAgIGFjdGl2ZTogKGl0ZW06IEl0ZW0pID0+ICFpdGVtLmNvbXBsZXRlZCxcbiAgICAgICAgICBjb21wbGV0ZWQ6IChpdGVtOiBJdGVtKSA9PiBpdGVtLmNvbXBsZXRlZCxcbiAgICAgICAgfVtmaWx0ZXJdXG4gICAgICApXG4gICAgICAubWFwKGVudGl0eVN0YXRlS2V5IGFzICgpID0+IEVudGl0eUtleTxJdGVtRW50aXR5Pik7IC8vIFRPRE8odHlwZSk6IGZpeCBjYXN0XG4gICAgdGhpcy4kc3RhdGUuZmlsdGVyID0gZmlsdGVyO1xuICAgIG1hcmtEaXJ0eSh0aGlzKTtcbiAgfVxuXG4gIGFzeW5jICRpbml0KCkge1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IHRoaXMuJHN0YXRlLml0ZW1zO1xuICB9XG5cbiAgYXN5bmMgJG5ld1N0YXRlKCk6IFByb21pc2U8VG9kbz4ge1xuICAgIGNvbnN0IGhvc3QgPSB0aGlzLiRlbGVtZW50O1xuICAgIHJldHVybiB7XG4gICAgICBjb21wbGV0ZWQ6IDAsXG4gICAgICBmaWx0ZXI6ICdhbGwnLFxuICAgICAgbmV4dElkOiA0LFxuICAgICAgaXRlbXM6IFtcbiAgICAgICAgSXRlbUVudGl0eS4kaHlkcmF0ZShob3N0LCB7IGlkOiAnMScgfSwgeyBjb21wbGV0ZWQ6IGZhbHNlLCB0aXRsZTogJ1JlYWQgUXdpayBkb2NzJyB9KS4ka2V5LFxuICAgICAgICBJdGVtRW50aXR5LiRoeWRyYXRlKGhvc3QsIHsgaWQ6ICcyJyB9LCB7IGNvbXBsZXRlZDogZmFsc2UsIHRpdGxlOiAnQnVpbGQgSGVsbG9Xb3JsZCcgfSlcbiAgICAgICAgICAuJGtleSxcbiAgICAgICAgSXRlbUVudGl0eS4kaHlkcmF0ZShob3N0LCB7IGlkOiAnMycgfSwgeyBjb21wbGV0ZWQ6IGZhbHNlLCB0aXRsZTogJ1Byb2ZpdCcgfSkuJGtleSxcbiAgICAgIF0sXG4gICAgfTtcbiAgfVxufVxuIl19